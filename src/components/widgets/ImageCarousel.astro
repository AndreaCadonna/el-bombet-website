---
// ImageCarousel.astro
interface ImageItem {
    src: string;
    alt?: string;
    title?: string;
}

interface Props {
    images: ImageItem[];
}

const { images } = Astro.props;

const safeImages = images.map(img => ({
    src: img.src,
    alt: img.alt || '',
    title: img.title || ''
}));
---

<div 
    class="relative w-full max-w-4xl mx-auto" 
    x-data={`{
        images: ${JSON.stringify(safeImages)},
        currentIndex: 0,
        isModalOpen: false,
        prev() {
            this.currentIndex = this.currentIndex === 0 
                ? this.images.length - 1 
                : this.currentIndex - 1;
        },
        next() {
            this.currentIndex = (this.currentIndex + 1) % this.images.length;
        },
        openModal() {
            this.isModalOpen = true;
            document.body.style.overflow = 'hidden';
        },
        closeModal() {
            this.isModalOpen = false;
            document.body.style.overflow = '';
        }
    }`}
    @keydown.escape.window="closeModal()"
>
    <!-- Thumbnail carousel -->
    <div class="overflow-hidden relative rounded-lg aspect-video">
        <div
            class="flex h-full transition-transform duration-500 ease-in-out"
            :style="`transform: translateX(-${currentIndex * 100}%)`"
        >
            {images.map((image) => (
                <div class="w-full h-full flex-shrink-0">
                    <img 
                        src={image.src} 
                        alt={image.alt || ''}
                        class="w-full h-full object-cover"
                        loading="lazy"
                    />
                </div>
            ))}
        </div>

        <!-- Expand button -->
        <button
            @click="openModal"
            class="absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors duration-300 z-10"
            aria-label="Open larger view"
        >
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <path d="M16 4l4 0l0 4" />
  <path d="M14 10l6 -6" />
  <path d="M8 20l-4 0l0 -4" />
  <path d="M4 20l6 -6" />
</svg>
        </button>

        <!-- Thumbnail Navigation buttons -->
        {images.length > 1 && (
            <>
                <button
                    @click="prev"
                    class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors duration-300 z-10"
                    aria-label="Previous slide"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                
                <button
                    @click="next"
                    class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors duration-300 z-10"
                    aria-label="Next slide"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            </>
        )}

        <!-- Thumbnail Image counter -->
        {images.length > 1 && (
            <div class="absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-md text-sm z-10">
                <span x-text="currentIndex + 1"></span>/<span x-text="images.length"></span>
            </div>
        )}

        <!-- Thumbnail Slide indicators -->
        {images.length > 1 && (
            <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-2 z-10">
                {images.map((_, index) => (
                    <button
                        @click={`currentIndex = ${index}`}
                        class="w-2 h-2 rounded-full transition-colors duration-300"
                        :class={`currentIndex === ${index} ? 'bg-white' : 'bg-white/50'`}
                        aria-label={`Go to slide ${index + 1}`}
                    />
                ))}
            </div>
        )}
    </div>

    <!-- Modal Overlay -->
    <template x-if="isModalOpen">
        <div
            class="fixed inset-0 z-50 overflow-auto bg-black/80"
            @click.self="closeModal"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
        >
            <div class="min-h-screen flex items-center justify-center p-4">
                <div class="relative w-full max-w-6xl bg-black rounded-lg">
                    <!-- Close button -->
                    <button
                        @click="closeModal"
                        class="absolute top-4 right-4 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors duration-300 z-20"
                        aria-label="Close modal"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>

                    <!-- Modal carousel -->
                    <div class="relative overflow-hidden" style="height: 80vh;">
                        <div
                            class="flex h-full will-change-transform"
                            :style="`transform: translateX(-${currentIndex * 100}%)`"
                        >
                            <template x-for="(image, index) in images" :key="index">
                                <div 
                                    class="w-full h-full flex-shrink-0 flex items-center justify-center transition-opacity duration-500"
                                    :class="{'opacity-100': index === currentIndex, 'opacity-0': index !== currentIndex}"
                                >
                                    <img 
                                        :src="image.src" 
                                        :alt="image.alt"
                                        class="max-w-full max-h-full object-contain transform transition-transform duration-500 ease-out"
                                        :class="{'scale-100': index === currentIndex, 'scale-95': index !== currentIndex}"
                                    />
                                </div>
                            </template>
                        </div>

                        <!-- Modal Navigation buttons -->
                        <template x-if="images.length > 1">
                            <div>
                                <button
                                    @click="prev"
                                    class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-4 rounded-full transition-colors duration-300 z-10"
                                    aria-label="Previous slide"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                    </svg>
                                </button>
                                
                                <button
                                    @click="next"
                                    class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-4 rounded-full transition-colors duration-300 z-10"
                                    aria-label="Next slide"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                    </svg>
                                </button>
                            </div>
                        </template>

                        <!-- Modal Image counter -->
                        <template x-if="images.length > 1">
                            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 text-white px-3 py-2 rounded-md text-sm z-10">
                                <span x-text="currentIndex + 1"></span>/<span x-text="images.length"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </template>
</div>


<style>
    /* Smooth sliding animation */
    [x-data] [x-cloak] { display: none !important; }
    
    .will-change-transform {
        transition: transform 500ms cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
    }

    /* Add smooth fade transition between slides */
    .transition-opacity {
        transition-property: opacity, transform;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Optional: Add a subtle zoom effect during transitions */
    .scale-95 {
        transform: scale(0.95);
    }

    .scale-100 {
        transform: scale(1);
    }
</style>